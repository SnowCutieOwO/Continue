# 交易记录

目前只支持将交易记录存储至插件文件夹下的 CSV 文件。尚不支持将日志记录至 SQL 数据库，或在游戏内浏览交易历史。

## CSV 交易记录

这个功能可以在配置文件的 `log-trades-to-csv`（默认禁用）处开启。启用后，插件会将交易存储在 `trade-logs` 文件夹下的 CSV 文件中。

若要防止 IO 读写操作堵塞服务器主线程，我们会记录在批处理文件中的交易记录：当交易发生时，我们会在将其记录进文件或其他后续交易发生前等待 30-45 秒（取决于额外的交易合并时间，见下）。

### 数据格式

交易会按日期分类：每个 CSV 文件分别存储一天之内发生的交易。当前，所有日期与时间信息都基于服务器选择的时区。

CSV 的时间格式可能不固定。如果你编写了自动处理这些文件的工具，你可能需要在时间格式更新之后修改程序的代码。

### 物品元数据

默认情况下，为了减小日志文件的体积，我们只记录参与交易的物品类型。设置 `log-item-metadata`（默认为 `false`）会让日志记录物品的元数据，例如示例的物品显示名称、描述等。

物品元数据为基于 Bukkit 物品序列化的紧凑 YAML 格式。见[物品序列化](more-information.item-serialization.md)了解更多。

### 交易合并

若要让记录的日志更为紧凑，我们会将一段时间内产生的相似交易合并为一条。

默认情况下，我们只会合并 15 秒内的多条相似交易，且这些交易的产生间隔不得大于 5 秒。设置 `trade-log-merge-duration-ticks` 与 `trade-log-next-merge-timeout-ticks` 控制着上述行为。它们也可以用于禁用交易日志合并。见[配置文件](installtion-updating.configuration.md)了解更多。